<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Novo Item - DesapegaQui</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

    <div id="menu-placeholder"></div>

    <div class="main-content">
        <button id="toggle-menu-btn" title="Recolher menu">«</button>

        <main>
            <div class="container">
                <section class="form-section">
                    <h1 class="section-title text-center">Cadastrar Novo Item</h1>
                    <p class="lead text-center">Preencha as informações abaixo para anunciar seu item na comunidade.</p>
                    
                    <form action="/seu-endpoint-de-cadastro" method="POST" enctype="multipart/form-data" class="item-form">

                        <div class="form-group">
                            <label for="item-foto">Foto do Item</label>
                            <input type="file" id="item-foto" name="itemFoto" required accept="image/*">
                            <small>Envie uma imagem nítida do seu item (JPG, PNG, etc.).</small>
                        </div>

                        <div class="form-group">
                            <label for="item-titulo">Título do Anúncio</label>
                            <input type="text" id="item-titulo" name="itemTitulo" placeholder="Ex: Bicicleta Vintage Restaurada" required maxlength="100">
                        </div>

                        <div class="form-group">
                            <label for="item-detalhes">Detalhes do Anúncio</label>
                            <textarea id="item-detalhes" name="itemDetalhes" rows="5" placeholder="Descreva o estado do item, marca, modelo e outros detalhes importantes." required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="item-valor">Valor Proposto (Lance inicial)</label>
                            <input type="number" id="item-valor" name="itemValor" placeholder="Ex: 150.00" min="0" step="0.01" required>
                            <small>Este será o valor inicial para os lances. Use '.' como separador decimal.</small>
                        </div>

                        <div class="form-group">
                            <label for="item-categoria">Categoria</label>
                            <select id="item-categoria" name="itemCategoria" required>
                                <option value="" disabled selected>Selecione uma categoria</option>
                                <option value="eletronicos">Eletrônicos</option>
                                <option value="vestuario">Vestuário e Acessórios</option>
                                <option value="moveis">Móveis e Decoração</option>
                                <option value="livros">Livros e Mídia</option>
                                <option value="esportes">Esportes e Lazer</option>
                                <option value="ferramentas">Ferramentas e Jardim</option>
                                <option value="materias-construção">Materiais de Construção</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="item-expiracao">Tempo de Expiração do Anúncio</label>
                            <select id="item-expiracao" name="itemExpiracao" required>
                                <option value="30" selected>30 dias (Padrão)</option>
                                <option value="15">15 dias</option>
                                <option value="7">1 semana</option>
                                <option value="1">24 horas</option>
                            </select>
                            <small>O anúncio será removido automaticamente após este período.</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Anunciar Item</button>
                        </div>

                    </form>
                </section>
            </div>
        </main>

        <footer class="main-footer">
            <div class="container">
                <p>&copy; 2025 DesapegaQui. Todos os direitos reservados.</p>
                <ul class="footer-links">
                    <li><a href="#">Termos de Serviço</a></li>
                    <li><a href="#">Política de Privacidade</a></li>
                </ul>
            </div>
        </footer>
    </div>

   <script src="../assets/js/script.js"></script>
    <script src="../assets/js/main.js"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const itemForm = document.querySelector('.item-form');

            // Remove o atributo 'action' para evitar o envio para um servidor.
            // Faremos o processamento aqui mesmo, no navegador.
            itemForm.removeAttribute('action');

            itemForm.addEventListener('submit', (event) => {
                // Previne o comportamento padrão do formulário (que seria recarregar a página)
                event.preventDefault();

                // 1. Coletar os dados do formulário
                const formData = new FormData(itemForm);

                const novoAnuncio = {
                    id: 'anuncio-' + Date.now(), // Cria um ID único baseado no tempo
                    titulo: formData.get('itemTitulo'),
                    detalhes: formData.get('itemDetalhes'),
                    valor: parseFloat(formData.get('itemValor')).toFixed(2),
                    categoria: formData.get('itemCategoria'),
                    expiracaoDias: parseInt(formData.get('itemExpiracao')),
                    dataCadastro: new Date().toISOString()
                };

                // 2. Processar a imagem
                const fotoInput = document.getElementById('item-foto');
                const fotoFile = fotoInput.files[0];

                if (fotoFile) {
                    const reader = new FileReader();

                    // Quando a leitura do arquivo terminar
                    reader.onloadend = () => {
                        // A imagem é convertida para Base64, um formato de texto
                        // que pode ser salvo no localStorage.
                        novoAnuncio.imagemBase64 = reader.result;
                        
                        // 3. Salvar o anúncio no localStorage
                        salvarAnuncio(novoAnuncio);
                    };

                    // Inicia a leitura do arquivo de imagem
                    reader.readAsDataURL(fotoFile);
                } else {
                    // Caso não haja foto (embora o campo seja 'required')
                    salvarAnuncio(novoAnuncio);
                }
            });

            function salvarAnuncio(anuncio) {
                // Busca os anúncios já existentes no localStorage. Se não houver, começa com um array vazio.
                const anunciosExistentes = JSON.parse(localStorage.getItem('anuncios')) || [];

                // Adiciona o novo anúncio à lista
                anunciosExistentes.push(anuncio);

                // Salva a lista atualizada de volta no localStorage
                // JSON.stringify converte o array de objetos em uma string, que é como o localStorage armazena dados.
                localStorage.setItem('anuncios', JSON.stringify(anunciosExistentes));

                // 4. Avisar o usuário e redirecionar
                alert('Anúncio cadastrado com sucesso!');
                window.location.href = 'home.html'; // Redireciona para a página inicial
            }
        });
    </script>
</body>
</html>